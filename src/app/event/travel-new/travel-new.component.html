<div class="container-fluid mt-4">
  <form novalidate (ngSubmit)="save()" [formGroup]="travelForm">

    <div class="btn-toolbar mb-4">
      <div class="btn-group mr-2" role="group" aria-label="First group">
        <button *ngFor="let page of steps.indices; let index=index" (click)="steps.current=index" type="button" [disabled]="((index < steps.indices.length-1 && !travelForm.get('steps').at(index).valid) && index != steps.current)||(index===steps.indices.length-1 && !travelForm.valid)"
          [ngClass]="{'active':steps.current===index}" class="btn btn-secondary active">{{page}}</button>
      </div>
      <div class="btn-group" role="group" aria-label="Second group">
        <button type="button" class="btn btn-secondary" (click)="populateTestData()">Insert Test Data</button>
      </div>

    </div>

    <div formArrayName="steps">

      <!-- FormArray Step 0 -->
      <div [formGroupName]="0" *ngIf="steps.current===0" [@viewChange]="slide">

        <div>
          <div class="form-check form-check-inline">
            <label class="form-check-label">
              <input class="form-check-input" type="radio" formControlName="travelType" value="offer"> Angebot
            </label>
          </div>
          <div class="form-check form-check-inline">
            <label class="form-check-label">
              <input class="form-check-input" type="radio" formControlName="travelType" value="request"> Gesuch
            </label>
          </div>
        </div>

        <button class="btn btn-secondary" (click)="steps.next" [disabled]="!travelForm.get('steps.0').valid">Next</button>

      </div>

      <!-- FormArray Step 1 -->
      <div [formGroupName]="1" *ngIf="steps.current===1" [@viewChange]="slide">
        <h3>Account für die Mitfahrbörse anlegen.</h3>
        <md-form-field>
          <input mdInput class="form-control" [ngClass]="{'is-invalid':validate(travelForm.get('steps.1.userName'))}" type="text" placeholder="Name *"
            formControlName="userName" />
        </md-form-field>
        <md-form-field>
          <input mdInput class="form-control" [ngClass]="{'is-invalid':validate(travelForm.get('steps.1.userAddress'))}" type="text"
            placeholder="Strasse *" formControlName="userAddress" />
        </md-form-field>
        <md-form-field>
          <input mdInput class="form-control" [ngClass]="{'is-invalid':validate(travelForm.get('steps.1.userPostCode'))}" type="text"
            placeholder="Postleitzahl *" formControlName="userPostCode" />
        </md-form-field>
        <md-form-field>
          <input mdInput class="form-control" [ngClass]="{'is-invalid':validate(travelForm.get('steps.1.userCity'))}" type="text" placeholder="Ort *"
            formControlName="userCity" />
        </md-form-field>
        <md-form-field>
          <input mdInput class="form-control" [ngClass]="{'is-invalid':validate(travelForm.get('steps.1.userPhoneNumber'))}" type="text"
            placeholder="Telefon *" formControlName="userPhoneNumber" />
        </md-form-field>
        <div formGroupName="userEmail">
          <md-form-field>
            <input mdInput class="form-control" [ngClass]="{'is-invalid':travelForm.get('steps.1.userEmail.email').validDebounced}" type="email"
              placeholder="Email *" formControlName="email" />
          </md-form-field>
          <md-form-field>
            <input mdInput class="form-control" [ngClass]="{'is-invalid':travelForm.get('steps.1.userEmail').errors||validate(travelForm.get('steps.1.userEmail.confirmEmail'))}"
              type="email" placeholder="Emailadresse wiederholen *" formControlName="confirmEmail" />
          </md-form-field>

        </div>

        <button class="btn btn-secondary" (click)="steps.next" [disabled]="!travelForm.get('steps.1').valid">Next</button>

      </div>

      <!-- FormArray Step 2 -->
      <div [formGroupName]="2" *ngIf="steps.current===2" [@viewChange]="slide">
        <h3>Kontaktdaten hinterlegen.</h3>
        <md-form-field>
          <input mdInput class="form-control" [ngClass]="{'is-invalid':validate(travelForm.get('steps.2.organisation'))}" type="text"
            placeholder="Organisation" formControlName="organisation" />
        </md-form-field>
        <md-form-field>
          <input mdInput class="form-control" [ngClass]="{'is-invalid':validate(travelForm.get('steps.2.contactName'))}" type="text"
            placeholder="Name *" formControlName="contactName" />
        </md-form-field>
        <md-form-field>
          <input mdInput class="form-control" [ngClass]="{'is-invalid':validate(travelForm.get('steps.2.phoneNumber'))}" type="text"
            placeholder="Telefon *" formControlName="phoneNumber" />
        </md-form-field>
        <md-form-field>
          <input mdInput class="form-control" [ngClass]="{'is-invalid':travelForm.get('steps.2.contactEmail').validDebounced}" type="email"
            placeholder="Email *" formControlName="contactEmail" />
        </md-form-field>

        <button class="btn btn-secondary" (click)="steps.next" [disabled]="!travelForm.get('steps.2').valid">Next</button>

      </div>

      <!-- FormArray Step 3 -->
      <div [formGroupName]="3" *ngIf="steps.current===3" [@viewChange]="slide">
        <h3>Abfahrtsort auswählen</h3>
        <md-form-field>
          <input mdInput appGoogleAutoComplete (notifyForAddressData)='googlePlacesAddressHandler($event)' class='form-control form-inline focus' type="search" placeholder="Suche eine Adresse"/>
        </md-form-field>

        <md-form-field>
          <input mdInput class="form-control" [ngClass]="{'is-invalid':validate(travelForm.get('steps.3.streetAddress'))}" type="text"
            placeholder="Strasse *" formControlName="streetAddress" />
        </md-form-field>
        <md-form-field>
          <input mdInput class="form-control" [ngClass]="{'is-invalid':validate(travelForm.get('steps.3.postcode'))}" type="text" placeholder="Postleitzahl *"
            formControlName="postcode" />
        </md-form-field>
        <md-form-field>
          <input mdInput class="form-control" [ngClass]="{'is-invalid':validate(travelForm.get('steps.3.city'))}" type="text" placeholder="Ort *"
            formControlName="city" />
        </md-form-field>

        <button class="btn btn-secondary" (click)="steps.next" [disabled]="!travelForm.get('steps.3').valid">Next</button>

      </div>

      <!-- FormArray Step 4 -->
      <div [formGroupName]="4" *ngIf="steps.current===4" [@viewChange]="slide">
        <h3>Mitfahrgelegenheit anbieten</h3>
        <select class="form-control" [ngClass]="{'is-invalid':validate(travelForm.get('steps.4.destinationId'))}" formControlName="destinationId">
            <option value=null disabled selected hidden>Ziel *</option>
            <option *ngFor="let destination of destinations" value="{{destination.id}}">{{destination.name}}</option>
          </select>
        <select class="form-control" [ngClass]="{'is-invalid':validate(travelForm.get('steps.4.transportationMeanId'))}" formControlName="transportationMeanId">
              <option value=null disabled selected hidden>Verkehrsmittel *</option>
              <option *ngFor="let transportationMean of transportationMeans" value="{{transportationMean.id}}">{{transportationMean.name}}</option>
            </select>

        <md-form-field>
          <input mdInput [mdDatepicker]="myDatepicker" [ngClass]="{'is-invalid':validate(travelForm.get('steps.4.departureDate'))}"
            placeholder="Abfahrt *" formControlName="departureDate">
          <md-datepicker-toggle mdSuffix [for]="myDatepicker"></md-datepicker-toggle>
          <md-datepicker #myDatepicker></md-datepicker>
        </md-form-field>

        <select class="form-control" [ngClass]="{'is-invalid':validate(travelForm.get('steps.4.departureHour'))}" formControlName="departureHour">
          <option value=null disabled selected hidden>Abfahrt Stunden *</option>
          <option *ngFor="let hour of departureHours" value="{{hour}}">{{hour}}</option>
        </select>

        <select class="form-control" [ngClass]="{'is-invalid':validate(travelForm.get('steps.4.departureMinute'))}" formControlName="departureMinute">
          <option value=null disabled selected hidden>Abfahrt Minuten *</option>
          <option *ngFor="let minute of departureMinutes" value="{{minute}}">{{minute}}</option>
        </select>

        <md-form-field>
          <textarea mdInput class="form-control" rows="4" placeholder="Beschreibung" formControlName="description"></textarea>
        </md-form-field>

        <button class="btn btn-secondary" (click)="steps.next" [disabled]="!travelForm.get('steps.4').valid">Next</button>

      </div>

      <div *ngIf="steps.current===5" [@viewChange]="slide">
        <h3>Zusammenfassung</h3>
        <pre>{{ travelForm.value | json }}</pre>
        <button class="btn btn-primary" type="submit" [disabled]="!travelForm.valid">Save</button>
      </div>

      <!--  -->

    </div>
  </form>
</div>
<div class="container-fluid mt-4">
  <br>
  <b>Form</b>
  <br>Dirty: {{ travelForm.dirty }}
  <br>Touched: {{ travelForm.touched }}
  <br>Valid: {{ travelForm.valid }}

</div>