<div class="container-fluid" *eventAssign="let travelsFiltered be travels | filter:textFilter:destinationFilter:transportationMeanFilter">

  <div class="select-destination">
    <div class="row" *ngIf='destinations && destinations.length > 0'>
      <div class="col-md-8">
        <p>Diese Demonstration findet in mehreren Städten statt.
          <br/> Bitte wähle Dein genaues Ziel aus dem rechts stehenden Feld aus.</p>
      </div>
      <div class="col-md-4 right-align">
        <div class="btn-group" dropdown>
          <button dropdownToggle type="button" class="btn dropdown-toggle">
            {{destinationFilter ? destinationFilter.name : 'Demoziel auswählen'}}
            <span class="caret"></span>
          </button>
          <ul *dropdownMenu class="dropdown-menu" role="menu">
            <li role="menuitem">
              <a class="dropdown-item" (click)="destinationFilter=null">Alle</a>
            </li>
            <li class="divider dropdown-divider"></li>
            <li *ngFor="let destination of destinations" role="menuitem">
              <a class="dropdown-item" (click)="destinationFilter=destination">{{destination.name}}</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
  <div id="map-wrap">
    <div>
      <agm-map [latitude]="51.948" [longitude]="10.2652" [zoom]="6">
        <!-- <agm-marker [latitude]="position.lat" [longitude]="position.lng" [markerDraggable]='true'></agm-marker> -->

        <agm-marker *ngFor='let travel of ( travelsFiltered | northToSouth )' [latitude]="travel.lat" [longitude]="travel.long" [iconUrl]='"./assets/images/icons/pin_" + travel.transportation_mean.id + ".png"'
          (markerClick)="showMarkerDetails(travel)"></agm-marker>
      </agm-map>
    </div>
  </div>

  <div class="row">
    <div class="col-md-8">
      <div class="btn-toolbar">
        <div class="step-nav-wrap mr-2" role="group" aria-label="First group">
          <button type="button" *ngFor='let filter of transportationMeanDisplay' [class.active-filter]='-1 !== transportationMeanFilter.indexOf(filter.id)'
            class="btn" (click)='updateTransportationMeanFilter(filter.id)'><i [class]='filter.iconClass'></i></button>
        </div>
      </div>
    </div>
    <div class="col-md-4 right-align">
      <div class="input-group padding-right">
        <div class="input-group-addon"><i class="icon-icon-filter"></i></div>
        <input type="text" [(ngModel)]="textFilter" class="form-control" placeholder="Tabelle individuell filtern">
      </div>
    </div>
  </div>

  <div class="travel-wrap">
    <div class="travel-header-wrap">
      <div class="row table-head">
        <div class="col-md-2">Plz</div>
        <div class="col-md-3">Abfahrtsort</div>
        <div class="col-md-2">Verkehrsmittel</div>
        <div class="col-md-3">Aktionsort</div>
        <div class="col-md-2">Entfernung</div>
      </div>
    </div>

    <div *ngFor="let travel of travelsFiltered | pagination:pager" class="travel-row-wrap">
      <div class="row" [class.show-details]='currentDetailsTravelId === travel.id' (click)='(currentDetailsTravelId === travel.id) ? currentDetailsTravelId = 0 : currentDetailsTravelId = travel.id'>
        <div class="col-md-2">{{travel.postcode}}</div>
        <div class="col-md-3">{{travel.city}}</div>
        <div class="col-md-2">{{travel.transportation_mean.name}}</div>
        <div class="col-md-3">{{travel.destination.name}}</div>
        <div class="col-md-2">111</div>
      </div>
      <div *ngIf='currentDetailsTravelId === travel.id' class="details-wrap" [@viewChange]="state">
        <section>
          <div class="row">
            <div class="col-md-12">
              <h2>Details zur Fahrt</h2>
            </div>
          </div>

          <div class="row">
            <div class="col-md-3">
              <span>Von</span>
            </div>
            <div class="col-md-9">
              <span>{{travel.street_address}}, {{travel.postcode}}, {{travel.city}}</span>
            </div>
          </div>

          <div class="row">
            <div class="col-md-3">
              <span>Nach</span>
            </div>
            <div class="col-md-9">
              <span>{{travel.destination.name}} ({{travel.destination.date | amParse:'YYYY-MM-DD' | amDateFormat:'DD.MM.YYYY'}})</span>
            </div>
          </div>

          <div class="row">
            <div class="col-md-3">
              <span>Verkehrsmittel</span>
            </div>
            <div class="col-md-9">
              <span>{{travel.transportation_mean.name}}</span>
            </div>
          </div>

          <div class="row">
            <div class="col-md-3">
              <span>ungefähre Abfahrtszeit</span>
            </div>
            <div class="col-md-9">
              <span>{{travel.departure_time | amParse:'YYYY-MM-DD hh:mm:ss' | amDateFormat:'D.MMMM YYYY, H:mm'}} Uhr</span>
            </div>
          </div>

          <div class="row">
            <div class="col-md-3">
              <span>Beschreibung</span>
            </div>
            <div class="col-md-9">
              <span>{{travel.description}}</span>
            </div>
          </div>
        </section>

        <section>
          <div class="row">
            <div class="col-md-12">
              <h2>Kontaktdetails</h2>
            </div>
          </div>

          <div class="row">
            <div class="col-md-3">
              <span>Name</span>
            </div>
            <div class="col-md-9">
              <span>{{travel.contact.name}}</span>
            </div>
          </div>

          <div class="row">
            <div class="col-md-3">
              <span>Organisation</span>
            </div>
            <div class="col-md-9">
              <span>{{travel.contact.organisation}}</span>
            </div>
          </div>
        </section>

        <div class="close-botton-wrap">

          <a role="button" class="btn-black" (click)='currentDetailsTravelId = 0'>Schließen</a>

        </div>

      </div>
    </div>

    <div *ngIf="travelsFiltered.length === 0" class="alert alert-danger" role="alert">
      Keine Fahrten gefunden
    </div>
    <nav class="pagination-wrap">
      <ul *ngIf="pager.pages && pager.pages.length" class="pagination">
        <li class="page-item" [ngClass]="{disabled:pager.currentPage === 1}">
          <a class="page-link icon-jump" (click)="setPage(1)">
            <<</a>
        </li>
        <!-- <li class="page-item" [ngClass]="{disabled:pager.currentPage === 1}">
          <a class="page-link" (click)="setPage(pager.currentPage - 1)">Previous</a>
        </li> -->
        <li *ngFor="let page of pager.pages" class="page-item" [ngClass]="{active:pager.currentPage === page}">
          <a class="page-link" (click)="setPage(page)">{{page}}</a>
        </li>
        <!-- <li class="page-item" [ngClass]="{disabled:pager.currentPage === pager.totalPages}">
          <a class="page-link" (click)="setPage(pager.currentPage + 1)">Next</a>
        </li> -->
        <li class="page-item" [ngClass]="{disabled:pager.currentPage === pager.totalPages}">
          <a class="page-link icon-jump" (click)="setPage(pager.totalPages)">>></a>
        </li>
      </ul>
    </nav>
  </div>